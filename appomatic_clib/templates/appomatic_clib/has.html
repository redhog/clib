{% extends "appomatic_clib/base.html" %}
{% load endless %}

{% block full-content %}
  <p>You can organize your things into <a href='{% url 'appomatic_clib.views.shelfs' %}'>shelfs</a> to find them more easily.</p>

  {% if request.user.has.count %}
    <div class="panel panel-default">
      <table class="table">
        {% if request.user.profile.has_borrowed.count %}
          {% paginate request.user.profile.has_borrowed.all using "has_borrowed" as has_borrowed %}
          <tr><th colspan="2">Borrowed things: {{request.user.profile.has_borrowed.count}}</th><th>by</th><th>owned by</th><th>shelf</th><th>tags</th></tr>
          {% for t in has_borrowed %}
            <tr>
              <td><a href='{{t.get_absolute_url}}'>{{t.type.barcode_type}}:{{t.type.barcode_data}}</td>
              <td><a href='{{t.get_absolute_url}}'>{{t.type.name}}</td>
              <td><a href='{% url 'appomatic_clib.views.search.search' %}?query={{t.type.designer}}'>{{t.type.designer}}</a></td>
              <td><a href='{{t.owner.profile.get_absolute_url}}'>{{t.owner.username}}</a></td>
              <td>{{t.shelf.render_as.link__html|safe}}</td>
              <td>{{t.type.render_as.tags|safe}}</td>
            </tr>
          {% endfor %}
          <tr>
            <td colspan="6">
              {% show_pages %}
            </td>
          </tr>
        {% endif %}

        {% if request.user.profile.has_own.count %}
          {% paginate request.user.profile.has_own.all using "has_own" as has_own %}
          <tr><th colspan="2">Own things held: {{request.user.profile.has_own.count}}</th><th>by</th><th></th><th>shelf</th><th>tags</th></tr>
          {% for t in has_own %}
            <tr>
              <td><a href='{{t.get_absolute_url}}'>{{t.type.barcode_type}}:{{t.type.barcode_data}}</td>
              <td><a href='{{t.get_absolute_url}}'>{{t.type.name}}</td>
              <td><a href='{% url 'appomatic_clib.views.search.search' %}?query={{t.type.designer}}'>{{t.type.designer}}</a></td>
              <td></td>
              <td>{{t.shelf.render_as.link__html|safe}}</td>
              <td>{{t.type.render_as.tags|safe}}</td>
            </tr>
          {% endfor %}
          <tr>
            <td colspan="6">
              {% show_pages %}
            </td>
          </tr>
        {% endif %}
      </table>
    </div>
  {% else %}
    <div class="alert alert-success" role="alert">
      You haven't borrowed anything. Maybe you'd like to search for things to borrow:

      <form action="{% url 'appomatic_clib.views.search.search' %}" class="form form-inline" role="form">
        <div class="input-group">
          <input type="text" name="query" placeholder="Search" class="form-control">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit"><i class='glyphicon glyphicon-search'></i>&nbsp;</button>
          </span>
        </div>
      </form>

    </div>
  {% endif %}
{% endblock %}
